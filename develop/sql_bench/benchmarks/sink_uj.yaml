# Benchmark configuration
benchmark_name: sample_benchmark

# SQL to set up the initial schema and data (run once)
setup_sql: |
  set streaming_enable_unaligned_join = true;

  create table dim(v1 int);
  insert into dim values (1), (2);
  
  create table fact(v0 int primary key, v1 int, v2 varchar, v3 varchar);

  create materialized view t as
  select v0, count(*) as cnt, sum(v0) as s, string_agg(v2, ',') as agg
  from fact join dim on fact.v1 = dim.v1
  group by v0;

  create table t2(v0 int primary key, cnt bigint, s bigint, agg varchar);
  create sink s1 into t2 from t;

  insert into fact
    select
      x as v0,
      1 as v1,
      'abcdefgakjandjkw' as v2,
      'jkb1ku1bu' as v3
    from generate_series(1, 2000000) t(x);
  insert into fact
    select
      x as v0,
      2 as v1,
      'abcdefgakjandjkw' as v2,
      'jkb1ku1bu' as v3
    from generate_series(2000001, 4000000) t(x);
  flush;
# SQL to prepare the data before each run
prepare_sql: |

# SQL to clean up after each run
conclude_sql: |
  insert into dim values (1), (2);
  flush;

# SQL to clean up everything after all runs are complete
cleanup_sql: |
  drop sink if exists s1;
  drop materialized view if exists m1;
  drop materialized view if exists t;
  drop table if exists t2;
  drop table if exists fact;
  drop table if exists dim;

# SQL to benchmark (optimized version)
benchmark_sql: |
  delete from dim;
  flush;

# Number of times to run the benchmark
runs: 3
