# RisingWave Dashboard

A web dashboard for monitoring and managing RisingWave streaming database.

## Features

### Relation Graph Improvements (Issue #20543)

The relation graph has been significantly improved to handle large and complex DAGs with better usability:

#### Key Improvements

1. **Modern ReactFlow Integration**
   - Upgraded from `react-flow-renderer` v10 to `@xyflow/react` v12
   - Better performance and rendering for large graphs
   - Built-in drag & drop support for nodes
   - Smooth animations and transitions

2. **Adaptive Layout with Dagre**
   - Automatic layout calculation using Dagre algorithm
   - Configurable spacing and direction
   - Optimized for readability with proper node spacing

3. **Sub-DAG Focus Mode**
   - Click "Focus Mode" button to show only upstream/downstream relations
   - Double-click any node to focus on its connections
   - Easy navigation between full view and focused view
   - Shows node count and current focus context

4. **Enhanced User Experience**
   - Drag nodes to rearrange manually
   - Zoom and pan controls
   - Background grid for better visual reference
   - Tooltips with detailed relation information
   - Visual feedback for selected nodes and connected edges

5. **Improved Visual Design**
   - Modern card-based node design
   - Color-coded relation types (Sources, Sinks, MVs, Tables)
   - Better contrast and readability
   - Responsive layout

#### Usage

- **View All Relations**: Click "Show All" to see the complete DAG
- **Focus on Specific Node**: 
  - Select a node and click "Focus Mode", or
  - Double-click any node to immediately focus on it
- **Navigate**: Double-click the focused node again to return to full view
- **Interact**: Drag nodes to reposition, use mouse wheel to zoom
- **Get Details**: Hover over nodes for detailed information

#### Technical Details

- Uses Dagre layout algorithm for automatic positioning
- ReactFlow provides built-in interaction capabilities
- Maintains backward compatibility with existing API
- Responsive design works on different screen sizes

### Development

#### Prerequisites

- Node.js 18+
- npm or yarn

#### Getting Started

```bash
cd dashboard
npm install
npm run dev
```

#### Building

```bash
npm run build
npm start
```

#### Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm run lint` - Run linting
- `npm run format` - Format code

### Technologies

- **Frontend**: Next.js, React, TypeScript
- **UI**: Chakra UI
- **Graph Visualization**: ReactFlow (@xyflow/react)
- **Layout**: Dagre
- **Data Visualization**: Recharts, D3

### API Integration

The dashboard connects to RisingWave's REST API endpoints:

- `/api/monitor/streaming_stats` - Real-time streaming statistics
- `/api/catalog/relations` - Relation metadata
- `/api/catalog/dependencies` - Relation dependencies

### Contributing

When working on the relation graph:

1. The main component is in `components/RelationGraph.tsx`
2. Layout logic uses Dagre in `getLayoutedElements()`
3. Sub-DAG filtering is in the `filteredData` memo
4. Node styling is in `RelationNodeComponent`

For other dashboard features, check the `pages/` directory for route implementations.

## Files

```plain
dashboard/
--.next/ (generated by nextjs)
--node_modules/ (development dependencies)
--out/ (generated static files)
--components/ (React Component)
--lib/ (useful functions and classes)
--pages/ (web pages)
--public/ (static resources)
--styles/ (static css files)
--test/ (test cases)
```

## Testing

TODO: Find a suitable testing framework

## Development

Start a RisingWave cluster, create some tables and materialized views for testing purposes.
For example:

```bash
./risedev d
./risedev slt  e2e_test/nexmark/create_sources.slt.part
./risedev psql -c 'CREATE TABLE dimension (v1 int);'
./risedev psql -c 'CREATE MATERIALIZED VIEW mv AS SELECT auction.* FROM dimension join auction on auction.id-auction.id = dimension.v1;'
./risedev psql -c 'CREATE MATERIALIZED VIEW mv2 AS SELECT * FROM mv;'
./risedev psql -c 'CREATE MATERIALIZED VIEW mv3 AS SELECT count(*) FROM mv2;'

./risedev psql -c 'CREATE MATERIALIZED VIEW mv4 AS SELECT * FROM mv;'
./risedev psql -c 'CREATE MATERIALIZED VIEW mv5 AS SELECT count(*) FROM mv2;'
./risedev psql -c 'CREATE MATERIALIZED VIEW mv6 AS SELECT mv4.* FROM mv4 join mv2 using(id);'
./risedev psql -c 'CREATE MATERIALIZED VIEW mv7 AS SELECT max(id) FROM mv;'

./risedev psql -c 'CREATE MATERIALIZED VIEW mv8 AS SELECT mv.* FROM mv join mv6 using(id);'
./risedev psql -c 'CREATE SCHEMA s1;'
./risedev psql -c 'CREATE TABLE s1.t1 (v1 int);'
./risedev psql -c 'CREATE MATERIALIZED VIEW s1.mv1 AS SELECT s1.t1.* FROM s1.t1 join mv on s1.t1.v1 = mv.id;'

./risedev psql -c 'INSERT INTO dimension select 0 from generate_series(1, 20);'
```

Install dependencies and start the development server.

```bash
npm i
npm run dev
```

The dashboard is now served at port 3000.
Go to the Settings page at `http://localhost:3000/settings/` and set the API endpoint to
`http://localhost:5691/api` in order to connect to the meta node of the running cluster.

## Test with RisingWave meta node

The approach above is the best way to develop the dashboard since it supports hot reload and debugging.
However, if you still want to test how the dashboard behaves when it's served as static files within the meta node,
you can ask RiseDev to build the dashboard from the source code by running the following command.

```bash
./risedev configure enable dashboard
```

The dashboard built with the latest sources will be served by meta node at port 5691.

## Deployment

### Generate the protos

Running `npm i` will generate the proto files under `proto/gen` automatically. In case there are modifications to the protos, you can regenerate them using the command npm run gen-proto.

### Static HTML files

Build static files for standalone deployment without node.js. The built files are generated at `./out`.
Check more details at [Static HTML Export](https://nextjs.org/docs/advanced-features/static-html-export).

```bash
npm run build
```

The built files are generated at `./out`.
