# AGENTS.md - Workspace Hack Crate

## 1. Scope

Policies for the `workspace-hack` crate - Workspace dependency unification managed by cargo hakari.

## 2. Purpose

Managed entirely by `cargo hakari` for workspace dependency unification. This crate ensures all workspace members use consistent dependency versions and feature sets, dramatically reducing compile times by avoiding duplicate dependency compilation with different features.

## 3. Structure

```
src/workspace-hack/
├── src/
│   └── lib.rs           # Stub lib (required for hakari to function)
├── build.rs             # Build script placeholder
├── Cargo.toml           # Auto-generated by cargo hakari - DO NOT EDIT MANUALLY
├── README.md            # Hakari documentation and usage
└── .gitattributes       # Git configuration for generated files
```

## 4. Key Files

| File | Purpose |
|------|---------|
| `Cargo.toml` | Auto-generated dependency unification (HAKARI SECTION) |
| `src/lib.rs` | Stub library required for crate structure |
| `build.rs` | Build script placeholder |
| `README.md` | Hakari documentation |
| `.gitattributes` | Mark generated files |

## 5. Edit Rules (Must)

- Do NOT manually edit files between HAKARI SECTION comments in Cargo.toml
- Use `cargo hakari generate` to regenerate after dependency changes
- Use `cargo hakari disable` to temporarily disable hakari management
- Use `cargo hakari enable` to re-enable after disabling
- Keep `src/lib.rs` as a stub (required for hakari to work)
- Ensure `publish = false` remains set in Cargo.toml
- Run `cargo hakari verify` after any workspace dependency changes
- Commit both Cargo.toml and .gitattributes changes together

## 6. Forbidden Changes (Must Not)

- Manually edit HAKARI SECTION markers or content in Cargo.toml
- Remove `publish = false` flag from Cargo.toml
- Add manual dependencies outside hakari management in this crate
- Delete or modify `src/lib.rs` content
- Commit workspace changes without running `cargo hakari verify`
- Use this crate for actual code - it is for dependency management only
- Modify build.rs without understanding hakari requirements

## 7. Test Entry

| Test Type | Entry Command |
|-----------|---------------|
| Verify hakari | `cargo hakari verify` |
| Regenerate | `cargo hakari generate` |
| Check workspace | `cargo check --workspace` |
| Test hakari managed | `cargo hakari managed` |

## 8. Dependencies & Contracts

- Management: `cargo hakari` CLI tool
- Build: `build.rs` (minimal stub required)
- Usage: All non-madsim crates include via `workspace-hack = { path = "../workspace-hack" }`
- Generation: Automatic via hakari based on workspace analysis
- Publishing: Disabled (`publish = false`)
- Version: Synchronized with workspace version

## 9. Overrides

None. This crate is auto-generated and should not have manual overrides.

## 10. Update Triggers

Regenerate this file when:
- Cargo hakari configuration changes
- Workspace structure modifications
- Dependency management approach updates
- Build script requirements change

## 11. Metadata

- Created: 2025-02-22
- Version: 1.0
- Parent: /home/k11/risingwave/AGENTS.md
