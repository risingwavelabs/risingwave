# mysql

system ok
mysql --host=mysql --port=3306 -u root -p123456 << EOF
CREATE DATABASE rwcdc;
USE rwcdc;
CREATE TABLE table_in_mysql (
    id INT PRIMARY KEY,
    name VARCHAR(255)
);
INSERT INTO table_in_mysql VALUES (1,'11'),(2,'22');
EOF

statement ok
CREATE SOURCE cdc_source_mysql WITH (
    connector = 'mysql-cdc',
    hostname='mysql',
    port=3306,
    database.name='rwcdc',
    username='root',
    password='123456'
);

statement ok
CREATE TABLE mysql_table_in_rw (
    id INT PRIMARY KEY,
    name VARCHAR
)
FROM cdc_source_mysql TABLE 'rwcdc.table_in_mysql';


# postgres

system ok
PGHOST=db PGPORT=5432 PGUSER=postgres PGPASSWORD='post\tgres' PGDATABASE=rwcdc createdb

system ok
PGHOST=db PGPORT=5432 PGUSER=postgres PGPASSWORD='post\tgres' PGDATABASE=rwcdc psql << EOF
CREATE TABLE table_in_postgres (
    id INT PRIMARY KEY,
    name VARCHAR(255)
);
INSERT INTO table_in_postgres VALUES (1,'11'),(2,'22');
EOF

statement ok
CREATE SOURCE cdc_source_postgres WITH (
    connector = 'postgres-cdc',
    hostname='db',
    port=5432,
    database.name='rwcdc',
    username='postgres',
    password='post\tgres'
);

statement ok
CREATE TABLE postgres_table_in_rw (
    id INT PRIMARY KEY,
    name VARCHAR
)
FROM cdc_source_postgres TABLE 'public.table_in_postgres';

# sqlserver

system ok
SQLCMDSERVER=sqlserver-server SQLCMDUSER=SA SQLCMDPASSWORD="SomeTestOnly@SA" SQLCMDPORT=1433 sqlcmd <<EOF
CREATE DATABASE rwcdc;
GO
USE rwcdc;
GO
EXEC sp_changedbowner 'SA';
GO
EXEC sys.sp_cdc_enable_db;
GO
CREATE TABLE table_in_sqlserver (
    id INT PRIMARY KEY,
    name VARCHAR(255)
);
GO
EXEC sys.sp_cdc_enable_table
  @source_schema = 'dbo',
  @source_name = 'table_in_sqlserver',
  @role_name = NULL;
GO
INSERT INTO table_in_sqlserver VALUES (1,'11'),(2,'22');
GO
EOF

statement ok
CREATE SOURCE cdc_source_sqlserver WITH (
    connector = 'sqlserver-cdc',
    hostname = 'sqlserver-server',
    port = '1433',
    username = 'SA',
    password = 'SomeTestOnly@SA',
    database.name = 'rwcdc',
);

statement ok
CREATE TABLE sqlserver_table_in_rw (
    id INT PRIMARY KEY,
    name VARCHAR
)
FROM cdc_source_sqlserver TABLE 'rwcdc.dbo.table_in_sqlserver';

# wait for all cdc backfill to complete
sleep 3s