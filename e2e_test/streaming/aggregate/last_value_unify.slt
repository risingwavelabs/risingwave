statement ok
SET RW_IMPLICIT_FLUSH TO true;

statement ok
create table t (
    a int,
    b int,
    c int,
    d int,
    e int,
    f int
);

statement ok
create materialized view mv_last_value_unify as
select
    first_value(a order by d) as first_a,
    last_value(a order by d desc) as last_a,
    first_value(b order by d) as first_b,
    last_value(b order by d desc) as last_b,
    first_value(c order by d) as first_c,
    last_value(c order by d desc) as last_c,
    count(a) as count_a,
    count(b) as count_b,
    count(c) as count_c,
    e,
    f
from t
group by e, f;

statement ok
flush;

query IIIIIIIII
select
    first_a,
    last_a,
    first_b,
    last_b,
    first_c,
    last_c,
    count_a,
    count_b,
    count_c
from mv_last_value_unify
order by e, f;
----

statement ok
insert into t values
(1, 10, 100, 1, 1, 1),
(2, 20, 200, 2, 1, 1),
(3, 30, 300, 3, 1, 1),
(7, 70, 700, 1, 2, 1);

query IIIIIIIII
select
    first_a,
    last_a,
    first_b,
    last_b,
    first_c,
    last_c,
    count_a,
    count_b,
    count_c
from mv_last_value_unify
order by e, f;
----
1 1 10 10 100 100 3 3 3
7 7 70 70 700 700 1 1 1

statement ok
insert into t values
(0, 5, 50, 0, 1, 1);

query IIIIIIIII
select
    first_a,
    last_a,
    first_b,
    last_b,
    first_c,
    last_c,
    count_a,
    count_b,
    count_c
from mv_last_value_unify
order by e, f;
----
0 0 5 5 50 50 4 4 4
7 7 70 70 700 700 1 1 1

statement ok
insert into t values
(9, 90, 900, 4, 1, 1);

query IIIIIIIII
select
    first_a,
    last_a,
    first_b,
    last_b,
    first_c,
    last_c,
    count_a,
    count_b,
    count_c
from mv_last_value_unify
order by e, f;
----
0 0 5 5 50 50 5 5 5
7 7 70 70 700 700 1 1 1

statement ok
drop materialized view mv_last_value_unify;

statement ok
drop table t;
