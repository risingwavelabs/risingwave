statement ok
set sink_decouple = false;

statement ok
CREATE TABLE t_jdbc_alter_src (
    id INT PRIMARY KEY,
    v1 INT
);

# NOTE: JDBC sink currently uses `user` instead of `username`.
statement ok
CREATE SINK s_jdbc_alter_props FROM t_jdbc_alter_src WITH (
    connector = 'jdbc',
    jdbc.url = 'jdbc:postgresql://db:5432/test?user=test&password=connector',
    table.name = 't_jdbc_alter_props',
    type = 'upsert',
    primary_key = 'id'
);

statement ok
ALTER SINK s_jdbc_alter_props CONNECTOR WITH (
    jdbc.url = 'jdbc:postgresql://db:5432/test',
    user = 'test',
    password = 'connector'
);

query I
select count(*)
from rw_sinks
where name = 's_jdbc_alter_props'
  and definition ILIKE '%jdbc.url = ''jdbc:postgresql://db:5432/test''%'
  and definition ILIKE '%user = ''test''%'
  and definition ILIKE '%password = ''connector''%';
----
1

statement error Field 'table.name' is not allowed to be altered on the fly for sink: jdbc
ALTER SINK s_jdbc_alter_props CONNECTOR WITH (table.name = 't_jdbc_alter_props_2');

statement ok
DROP SINK s_jdbc_alter_props;

statement ok
DROP TABLE t_jdbc_alter_src;
