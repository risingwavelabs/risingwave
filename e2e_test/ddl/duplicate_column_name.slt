# Test for duplicate column names in SELECT statements
# Issue: https://github.com/risingwavelabs/risingwave/issues/24095

statement ok
SET RW_IMPLICIT_FLUSH TO true;

# Test 1: Duplicate column names in CTE - exact same case
statement error
with cte as (
  select
    1 as col,
    2 as col
)
select cte.col from cte;

# Test 2: Duplicate column names in simple SELECT
statement error
select 1 as col, 2 as col;

# Test 3: Duplicate column names with different types
statement error
select 1 as x, 2.5 as x, 'hello' as x;

# Test 4: Duplicate column names (case insensitive for unquoted identifiers)
# In PostgreSQL, unquoted identifiers are folded to lowercase
statement error
select 1 as col, 2 as COL;

# Test 5: Case sensitive when double quoted - these are different
query II
select 1 as "Col", 2 as "col";
----
1	2

# Test 6: No error when column names are different
query II
select 1 as col1, 2 as col2;
----
1	2

# Test 7: Multiple unnamed columns are OK
query II
select 1, 2;
----
1	2

# Test 8: Mix of named and unnamed columns is OK
query II
select 1 as col, 2;
----
1	2

# Test 9: Multiple duplicate columns in the middle
statement error
select 1 as a, 2 as b, 3 as a, 4 as b;

# Test 10: Duplicate columns with table reference
statement ok
create table test_table(col int);

# This should error - duplicate column in SELECT
statement error
select test_table.col as col, 1 as col from test_table;

# This should error - selecting the same column twice
statement error
select test_table.col, test_table.col from test_table;

# Clean up
statement ok
drop table test_table;


