# Test secret references as UDF parameters
# This tests the primary use case: UDFs calling external APIs with secret credentials

# Note: These tests require a wasm/javascript UDF implementation
# For now they demonstrate the syntax and binding behavior

statement ok
CREATE SECRET http_token WITH (backend = 'meta') AS 'secret_bearer_token_xyz';

statement ok
CREATE SECRET db_host WITH (backend = 'meta') AS 'db.example.com';

# Example UDF syntax for passing secrets
# The actual execution would require implementing UDFs in supported languages
# statement ok
# CREATE FUNCTION call_external_api(url VARCHAR, secret token VARCHAR) RETURNS VARCHAR LANGUAGE javascript AS '
#   const https = require("https");
#   return fetch(url, { headers: { Authorization: "Bearer " + token } });
# ';

# Example: SELECT call_external_api('https://api.example.com/data', secret http_token);

# Test that secrets can be used in the same expression with regular arguments
statement ok
SELECT 'prefix_' || secret http_token || '_suffix';

# Test error case: secret referenced without being a function/expression argument
# (Secrets are only valid in function argument expressions)
statement error
SELECT secret http_token FROM (SELECT 1) t;
----

statement ok
DROP SECRET http_token;

statement ok
DROP SECRET db_host;
