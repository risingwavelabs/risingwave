# Test error handling for secret references in function WITH options

# Create test secrets
statement ok
CREATE SECRET valid_secret WITH (backend = 'meta') AS 'secret_value';

# Test error: referencing non-existent secret in WITH options
statement error
CREATE FUNCTION test_func(dummy INT) RETURNS INT LANGUAGE sql AS 'SELECT length(my_secret)' WITH (my_secret = secret nonexistent_secret);

# Test error: duplicate secret parameter names
statement error
CREATE FUNCTION test_func(dummy INT) RETURNS INT LANGUAGE sql AS 'SELECT 1' WITH (my_secret = secret valid_secret, my_secret = secret valid_secret);

# Test error: unknown WITH option (not a secret)
statement error
CREATE FUNCTION test_func(dummy INT) RETURNS INT LANGUAGE sql AS 'SELECT 1' WITH (unknown_option = 123);

# Clean up
statement ok
DROP SECRET valid_secret;
