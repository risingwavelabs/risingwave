# Test secret references in function parameters

statement ok
CREATE SECRET api_key WITH (backend = 'meta') AS 'test_api_key_value';

statement ok
CREATE SECRET db_password WITH (backend = 'meta') AS 'super_secret_password';

# Test secret as TEXT reference (default)
statement ok
SELECT secret api_key;

# Test secret with AS FILE reference
statement ok
SELECT secret api_key AS FILE;

# Test secret in builtin string functions - secrets are passed as varchar literals
# For strlen(secret api_key), the secret value 'test_api_key_value' should be passed
# and strlen should return 18 (length of 'test_api_key_value')
statement ok
SELECT length(secret api_key) = 18;

# Test multiple secrets in function arguments
statement ok
SELECT length(secret api_key) + length(secret db_password) = 18 + 22;

# Test secret in concatenation
statement ok
SELECT concat(secret api_key, '_', secret db_password);

# Test secret in CASE expression
statement ok
SELECT CASE WHEN length(secret api_key) > 0 THEN secret db_password ELSE 'default' END;

# Test secret with parameter in builtin function
statement ok
SELECT substring(secret api_key, 1, 4) = 'test';

# Test secret as TEXT (default reference type)
statement ok
SELECT length(secret api_key AS TEXT) = 18;

# Clean up
statement ok
DROP SECRET api_key;

statement ok
DROP SECRET db_password;

# Verify secrets are dropped
query T
SHOW SECRETS;
----
