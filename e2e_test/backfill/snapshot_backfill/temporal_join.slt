control substitution off

statement ok
set backfill_rate_limit = 500;

statement ok
set streaming_use_snapshot_backfill = true;

statement ok
create table temporal_join_stream (
    id int,
    payload int,
    ts timestamp with time zone,
    watermark for ts as ts - interval '1' second,
    primary key (id)
) append only;

statement ok
create table temporal_join_lookup (
    id int primary key,
    info int
);

statement ok
insert into temporal_join_lookup values (1, 10), (2, 20);

statement ok
insert into temporal_join_stream values (1, 100, '2024-01-01 00:00:00+00');

statement ok
create materialized view temporal_join_mv as
select s.id, s.payload, l.info
from temporal_join_stream as s
left join temporal_join_lookup for system_time as of proctime() as l
on s.id = l.id;

query III
select id, payload, info from temporal_join_mv order by id;
----
1 100 10

statement ok
insert into temporal_join_stream values (2, 200, '2024-01-02 00:00:00+00');

statement ok
flush;

query III
select id, payload, info from temporal_join_mv order by id;
----
1 100 10
2 200 20

statement ok
drop materialized view temporal_join_mv;

statement ok
drop table temporal_join_stream;

statement ok
drop table temporal_join_lookup;
