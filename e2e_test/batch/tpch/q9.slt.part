query TRR
select
	nation,
	o_year,
	round(sum(amount), 2) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%yellow%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
----
ARGENTINA       1998  17702.73
ARGENTINA       1997  36930.35
ARGENTINA       1996  47578.21
ARGENTINA       1995  22721.98
ARGENTINA       1994  124668.02
ARGENTINA       1993  16836.47
ARGENTINA       1992  64482.53
ETHIOPIA        1998  12131.22
ETHIOPIA        1997  64632.50
ETHIOPIA        1996  53934.34
ETHIOPIA        1995  85465.81
ETHIOPIA        1994  34909.05
ETHIOPIA        1993  31486.65
ETHIOPIA        1992  31517.77
IRAN            1998  129127.65
IRAN            1997  241048.32
IRAN            1996  146418.41
IRAN            1995  124277.67
IRAN            1994  48054.39
IRAN            1993  205033.11
IRAN            1992  7877.70
IRAQ            1998  44838.65
IRAQ            1997  136849.98
IRAQ            1996  14714.79
IRAQ            1995  38901.46
IRAQ            1994  47418.84
IRAQ            1993  66470.31
IRAQ            1992  19538.72
KENYA           1998  74017.95
KENYA           1996  125975.94
KENYA           1995  126080.69
KENYA           1994  84763.53
KENYA           1993  59241.21
KENYA           1992  41107.38
MOROCCO         1998  9866.13
MOROCCO         1997  26329.79
MOROCCO         1996  5685.95
MOROCCO         1995  7136.46
MOROCCO         1993  18644.56
MOROCCO         1992  7595.75
PERU            1998  87426.11
PERU            1997  182190.68
PERU            1996  151040.18
PERU            1995  128684.42
PERU            1994  143664.16
PERU            1993  174091.66
PERU            1992  151399.17
UNITED KINGDOM  1998  43670.78
UNITED KINGDOM  1997  123308.05
UNITED KINGDOM  1996  126535.39
UNITED KINGDOM  1995  119817.01
UNITED KINGDOM  1994  46739.96
UNITED KINGDOM  1993  135827.18
UNITED KINGDOM  1992  190399.46
UNITED STATES   1998  3284.50
UNITED STATES   1997  94912.29
UNITED STATES   1996  136645.10
UNITED STATES   1995  47310.21
UNITED STATES   1994  62865.10
UNITED STATES   1993  87610.25
UNITED STATES   1992  54695.19
