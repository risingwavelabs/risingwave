# CDC MySQL source validate test

statement error CDC connector type 'mysql-cdc' does not support CREATE TABLE ... WITH (...), please use CREATE SOURCE and then CREATE TABLE FROM SOURCE.
create table should_fail (
  id INT PRIMARY KEY,
  name STRING
) with (
  connector = 'mysql-cdc',
  hostname = 'mysql',
  port = '3306',
  username = 'root',
  password = '123456',
  database.name = 'my@db',
  table.name = 'should_fail',
  server.id = '5099'
);

# invalid username
statement ok
create source src_invalid_user with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'rot',
 password = '123456',
 database.name = 'my@db',
 server.id = '5085'
);
statement error
create table products ( id INT,
 name STRING,
 description STRING,
 PRIMARY KEY (id)
) from src_invalid_user table 'my@db.products';

# invalid password
statement ok
create source src_invalid_pwd with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '1456',
 database.name = 'my@db',
 server.id = '5085'
);
statement error
create table products ( id INT,
 name STRING,
 description STRING,
 PRIMARY KEY (id)
) from src_invalid_pwd table 'my@db.products';

# invalid database name
statement ok
create source src_invalid_db with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '123456',
 database.name = 'mdb',
 server.id = '5085'
);
statement error
create table products ( id INT,
 name STRING,
 description STRING,
 PRIMARY KEY (id)
) from src_invalid_db table 'mdb.products';

# invalid table name
statement ok
create source src_invalid_table with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '123456',
 database.name = 'my@db',
 server.id = '5085'
);
statement error
create table products ( id INT,
 name STRING,
 description STRING,
 PRIMARY KEY (id)
) from src_invalid_table table 'my@db.prdcts';

# empty table name
statement ok
create source src_empty_table with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '123456',
 database.name = 'my@db',
 server.id = '5085'
);
statement error
create table products ( id INT,
 name STRING,
 description STRING,
 PRIMARY KEY (id)
) from src_empty_table table '';

# invalid primary key
statement ok
create source src_invalid_pk with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '123456',
 database.name = 'my@db',
 server.id = '5086'
);
statement error
create table orders (
   order_id int,
   order_date timestamp,
   customer_name string,
   price decimal,
   product_id int,
   order_status smallint,
   PRIMARY KEY (product_id)
) from src_invalid_pk table 'my@db.orders';

# column data type mismatch
statement ok
create source src_type_mismatch with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '123456',
 database.name = 'my@db',
 server.id = '5086'
);
statement error
create table orders (
   order_id int,
   order_date timestamp,
   customer_name string,
   price double,
   product_id int,
   order_status smallint,
   PRIMARY KEY (order_id)
) from src_type_mismatch table 'my@db.orders';

# column name mismatch
statement ok
create source src_colname_mismatch with (
 connector = 'mysql-cdc',
 hostname = 'mysql',
 port = '3306',
 username = 'root',
 password = '123456',
 database.name = 'my@db',
 server.id = '5086'
);
statement error
create table orders (
   order_id int,
   order_date timestamp,
   cust_name string,
   price decimal,
   product_id int,
   order_status smallint,
   PRIMARY KEY (order_id)
) from src_colname_mismatch table 'my@db.orders';
